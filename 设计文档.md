# **设计文档（How）**  

---

## **一、系统架构设计**  

### **1. 技术栈**  
- **前端**：Electron（支持Windows/Linux跨平台）  
- **后端**：Python（账单解析引擎）、SQLite（本地数据库）  
- **数据安全**：AES-256加密算法（本地数据存储）  

---

## **二、核心功能实现方案**  

### **1. 预设高频场景功能**  
- **交互设计**：  
  - 主界面置顶“三餐”“交通”等场景快捷入口，点击后直接输入金额。  
  - 长按场景图标进入编辑模式，支持自定义图标与名称。  
- **技术实现**：  
  - 场景配置数据存储于`preset_scenes.json`，结构示例：  
    ```json
    {
      "scenes": [
        {"name": "早餐", "icon": "breakfast.png", "defaultAmount": 5},
        {"name": "洗衣", "icon": "laundry.png", "defaultAmount": 3}
      ]
    }
    ```

---

### **2. 多平台账单导入与解析**  
- **技术流程**：  
  1. **文件解析**：  
     - 微信账单：解析`交易时间、金额、商家名称`字段，忽略“红包”类型。  
     - 支付宝账单：适配`业务流水号、商品名称`字段映射。  
  2. **数据清洗**：  
     ```python
     def clean_data(record):
         if "红包" in record["类型"]:
             return None  # 过滤红包记录
         if record["金额"] < 0.1:
             return None  # 忽略0.1元以下噪声数据
         return record
     ```
  3. **自动分类**：  
     - 预置规则库：`rules = {"奶茶": "餐饮", "地铁": "交通"}`  
     - 用户自定义规则优先级高于系统规则。  

---

### **3. 流水分类逻辑设计**  
- **智能分类引擎**：  
  - **关键词匹配**：使用正则表达式匹配商家名称（示例）：  
    ```python
    def match_category(merchant_name):
        if re.search(r"(奶茶|咖啡)", merchant_name):
            return "餐饮"
        elif re.search(r"(洗衣|澡堂)", merchant_name):
            return "生活服务"
        return "其他"
    ```
  - **用户修正机制**：  
    - 提供“批量修改”入口，支持选择多条记录后统一调整分类。  

---

### **4. 数据可视化实现**  
- **图表库选型**：ECharts（开源可视化库）  
- **关键指标计算**：  
  - **月度超支预警**：  
    ```sql
    SELECT SUM(amount) FROM records 
    WHERE category = "餐饮" AND date BETWEEN '2023-10-01' AND '2023-10-31'
    HAVING SUM(amount) > 500;  -- 与预设预算对比
    ```
  - **消费趋势图**：按日/周粒度聚合支出数据。  

---

## **三、非功能需求实现方案**  

### **1. 兼容性设计**  
- **跨平台适配**：  
  - 使用Electron打包Windows/Linux/macOS客户端，确保UI组件兼容性。  
- **账单格式兼容**：  
  - 微信/支付宝账单解析器支持版本回溯，定期更新规则库。  

### **2. 安全设计**  
- **数据加密**：  
  - 本地数据库采用SQLCipher加密，密钥由用户自定义。  
- **隐私保护**：  
  - 不上传原始账单数据，云同步仅传输分类后元数据（如“类别:餐饮,金额:20”）。  

---

## **四、迭代计划**  

### **1. MVP版本（V1.0）**  
- 核心功能：预设场景、账单导入、基础分类、图表展示。  
- 开发周期：4周（2周开发+2周测试）。  

### **2. 后续迭代**  
| 版本   | 功能                 | 技术方案                      |  
|--------|----------------------|-------------------------------|  
| V2.0   | 移动端适配           | React Native跨平台框架        |  
| V2.1   | 消费趋势预测         | 时间序列分析（ARIMA模型）     |  
| V2.2   | 账单数据云同步       | 云端数据库（Firebase）         |  
| V3.0   | 校园卡数据对接       | 学校API接口集成（需权限申请） |  

---

## **五、风险应对**  
- **风险**：商家名称匹配准确率低  
  - **应对方案**：  
    1. 用户反馈机制：允许标记错误分类并补充规则。  
    2. 模型优化：收集数据后训练朴素贝叶斯分类器。  
    3. 人工审核入口：复杂记录可手动分类。  
    4. 联网搜索：通过商家名称搜索商家信息进行分类。

--- 
